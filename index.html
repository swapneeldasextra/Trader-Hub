<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trader Hub | Premium</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --bg: #f8fafc;
    }
    body { 
      background-color: var(--bg); 
      color: #0f172a; 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      -webkit-tap-highlight-color: transparent;
    }
    .premium-card { 
      background: white; 
      border-radius: 28px; 
      border: 1px solid rgba(226, 232, 240, 0.8);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04); 
    }
    .nav-tab { 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      cursor: pointer;
    }
    .nav-active { 
      color: var(--primary); 
      font-weight: 700;
    }
    .nav-active::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--primary);
      border-radius: 10px;
    }
    input, textarea, select { 
      background: #f1f5f9 !important; 
      border: 1px solid #e2e8f0 !important; 
      transition: all 0.2s ease;
    }
    input:focus, textarea:focus {
      background: white !important;
      border-color: var(--primary) !important;
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1) !important;
      outline: none;
    }
    .syncing { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    
    .btn-gradient {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
    }
    .btn-gradient:active { transform: scale(0.98); }

    /* For desktop responsiveness */
    @media (min-width: 1024px) {
      .app-container { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; align-items: start; }
    }
  </style>
</head>
<body class="min-h-screen">

  <div id="app" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-[80vh] flex flex-col items-center justify-center animate-fade-in">
      <div class="w-full max-w-md">
        <div class="text-center mb-10">
          <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-[2rem] shadow-2xl shadow-blue-200 mb-6 rotate-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
              </svg>
          </div>
          <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">Trader Hub</h1>
          <p class="text-slate-400 mt-3 font-medium">Elevate your trading strategy.</p>
        </div>
        
        <div class="premium-card p-8 sm:p-10">
          <div class="space-y-5">
            <div>
              <label class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block">Identity</label>
              <input type="email" id="email" class="w-full p-4 rounded-2xl" placeholder="Email Address">
            </div>
            <input type="text" id="username" class="w-full p-4 rounded-2xl" placeholder="Display Name">
            <input type="password" id="password" class="w-full p-4 rounded-2xl" placeholder="Password">
            <button onclick="handleAuth()" id="auth-btn" class="w-full btn-gradient text-white font-bold py-4 rounded-2xl shadow-xl shadow-blue-100 mt-4 text-lg">
              Sign In
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="hidden">
      <!-- Header Area -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-10">
        <div>
          <h2 class="text-3xl font-extrabold text-slate-900">Hello, <span id="display-name" class="text-blue-600">Trader</span></h2>
          <p class="text-sm text-slate-400 font-semibold mt-1">Welcome back to your workstation</p>
        </div>
        <div class="flex items-center gap-3 w-full sm:w-auto">
            <button onclick="loadData()" id="sync-btn" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-5 py-3 bg-white rounded-2xl border border-slate-200 shadow-sm text-blue-600 font-bold active:bg-slate-50">
                <svg id="sync-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Sync Hub
            </button>
            <button onclick="logout()" class="p-3 bg-red-50 rounded-2xl border border-red-100 text-red-500 hover:bg-red-100 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
            </button>
        </div>
      </div>

      <!-- Navigation for Mobile/Web -->
      <div class="flex space-x-10 mb-8 text-sm font-bold border-b border-slate-200 px-2">
        <button onclick="switchTab('feed')" id="tab-feed" class="pb-4 nav-tab nav-active">TEAM FEED</button>
        <button onclick="switchTab('trade')" id="tab-trade" class="pb-4 nav-tab text-slate-400">POSITIONS</button>
      </div>

      <!-- Content Area -->
      <div class="app-container">
        
        <!-- Feed Section -->
        <div id="feed-section" class="space-y-6">
          <div class="premium-card p-6">
            <label class="text-[10px] font-black text-slate-400 tracking-widest uppercase mb-3 block">Create Update</label>
            <textarea id="post-input" class="w-full p-4 resize-none text-sm rounded-2xl" rows="3" placeholder="Share market sentiment or analysis..."></textarea>
            <div class="flex justify-end mt-4">
              <button onclick="postUpdate()" id="post-btn" class="btn-gradient text-white px-10 py-3 rounded-xl text-sm font-bold shadow-lg shadow-blue-100">Broadcast</button>
            </div>
          </div>
          <div id="feed-content" class="grid grid-cols-1 gap-4">
              <!-- Posts -->
          </div>
        </div>

        <!-- Trade Section -->
        <div id="trade-section" class="hidden lg:block">
          <div class="premium-card p-8 mb-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-1.5 h-6 bg-blue-600 rounded-full"></div>
                <h3 class="font-extrabold text-xl text-slate-800">New Entry</h3>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div class="space-y-2">
                  <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider ml-1">Asset</label>
                  <input type="text" id="trade-pair" placeholder="BTC/USDT" class="w-full p-4 rounded-xl text-sm font-semibold">
              </div>
              <div class="space-y-2">
                  <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider ml-1">Type</label>
                  <select id="trade-action" class="w-full p-4 rounded-xl text-sm font-bold appearance-none cursor-pointer">
                    <option value="BUY">LONG</option>
                    <option value="SELL">SHORT</option>
                  </select>
              </div>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-8">
              <div class="space-y-2">
                  <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider ml-1">Entry</label>
                  <input type="number" id="trade-entry" placeholder="0.00" class="w-full p-4 rounded-xl text-sm">
              </div>
              <div class="space-y-2">
                  <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider ml-1">T.P</label>
                  <input type="number" id="trade-tp" placeholder="0.00" class="w-full p-4 rounded-xl text-sm">
              </div>
              <div class="space-y-2">
                  <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider ml-1">S.L</label>
                  <input type="number" id="trade-sl" placeholder="0.00" class="w-full p-4 rounded-xl text-sm">
              </div>
            </div>
            <button onclick="logTrade()" id="trade-btn" class="w-full btn-gradient text-white py-5 rounded-2xl font-bold shadow-xl shadow-blue-100 text-lg">Log Position</button>
          </div>
          
          <h4 class="text-xs font-black text-slate-400 tracking-widest mb-4 px-2">LOG HISTORY</h4>
          <div id="trade-list" class="space-y-4"></div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // AUTO-ADDED SCRIPT URL
    const scriptUrl = "https://script.google.com/macros/s/AKfycbwo8AYMh2L3flnkJSz2FQUmWB7O7YeY94NGcLby8_vFnXbzB7ieiOgVsN2He-AIGVzrAg/exec";
    
    let user = { name: '', email: '' };
    let isGoogleEnv = typeof google !== 'undefined' && google.script && google.script.run;

    // Check for existing session
    window.onload = function() {
      const savedUser = localStorage.getItem('trader_hub_user');
      if (savedUser) {
        user = JSON.parse(savedUser);
        showMainApp();
      }
    };

    async function syncWithDatabase(methodName, params, successCallback) {
      if (isGoogleEnv) {
        google.script.run.withSuccessHandler(successCallback).withFailureHandler(err => {
          console.error(err);
          alert("Database Error");
        })[methodName](...params);
      } 
      else {
        try {
          const finalUrl = `${scriptUrl}?action=${methodName}&data=${encodeURIComponent(JSON.stringify(params))}`;
          const response = await fetch(finalUrl);
          const resData = await response.json();
          successCallback(resData);
        } catch (err) {
          console.error(err);
          // Fallback only for auth testing
          if(methodName === 'authenticateUser') successCallback({ success: true, username: params[1] });
        }
      } 
    }

    function handleAuth() {
      const email = document.getElementById('email').value;
      const name = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      const btn = document.getElementById('auth-btn');

      if(!email || !name || !pass) return;
      
      btn.innerText = "Verifying...";
      btn.disabled = true;

      syncWithDatabase('authenticateUser', [email, name, pass], (res) => {
        if(res && res.success) {
          user = { name: res.username || name, email: email };
          localStorage.setItem('trader_hub_user', JSON.stringify(user));
          showMainApp();
        } else {
          alert(res?.message || "Auth Failed");
          btn.innerText = "Sign In";
          btn.disabled = false;
        }
      });
    }

    function showMainApp() {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.remove('hidden');
      document.getElementById('display-name').innerText = user.name;
      loadData();
    }

    function logout() {
      localStorage.removeItem('trader_hub_user');
      location.reload();
    }

    function loadData() {
      const icon = document.getElementById('sync-icon');
      icon.classList.add('syncing');

      syncWithDatabase('getAppData', [], (data) => {
        if(data) {
          renderFeed(data.posts);
          renderTrades(data.trades);
        }
        setTimeout(() => icon.classList.remove('syncing'), 600);
      });
    }

    function postUpdate() {
      const content = document.getElementById('post-input').value;
      if(!content) return;
      const btn = document.getElementById('post-btn');
      btn.innerText = "Posting...";

      syncWithDatabase('saveData', ['POST', { id: Date.now(), user: user.name, content: content }], () => {
        document.getElementById('post-input').value = "";
        btn.innerText = "Broadcast";
        loadData();
      });
    }

    function logTrade() {
      const payload = {
        user: user.name,
        pair: document.getElementById('trade-pair').value,
        action: document.getElementById('trade-action').value,
        entry: document.getElementById('trade-entry').value,
        tp: document.getElementById('trade-tp').value,
        sl: document.getElementById('trade-sl').value
      };

      if(!payload.pair || !payload.entry) return alert("Fill Asset & Entry");
      
      const btn = document.getElementById('trade-btn');
      btn.innerText = "Logging Position...";

      syncWithDatabase('saveData', ['TRADE', payload], () => {
        document.getElementById('trade-pair').value = "";
        document.getElementById('trade-entry').value = "";
        btn.innerText = "Log Position";
        loadData();
      });
    }

    function switchTab(tab) {
      const isMobile = window.innerWidth < 1024;
      if (isMobile) {
        document.getElementById('feed-section').classList.toggle('hidden', tab !== 'feed');
        document.getElementById('trade-section').classList.toggle('hidden', tab !== 'trade');
      } else {
        // Desktop always shows both or switches focus
        document.getElementById('feed-section').classList.remove('hidden');
        document.getElementById('trade-section').classList.remove('hidden');
      }
      
      document.getElementById('tab-feed').className = tab === 'feed' ? 'pb-4 nav-tab nav-active' : 'pb-4 nav-tab text-slate-400';
      document.getElementById('tab-trade').className = tab === 'trade' ? 'pb-4 nav-tab nav-active' : 'pb-4 nav-tab text-slate-400';
    }

    function renderFeed(posts) {
      let html = "";
      if (!posts || posts.length <= 1) {
        document.getElementById('feed-content').innerHTML = "<div class='premium-card p-10 text-center text-slate-400'>No activity yet</div>";
        return;
      }
      for(let i = posts.length - 1; i >= 1; i--) {
        const time = posts[i][3] ? new Date(posts[i][3]).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : "now";
        html += `
          <div class="premium-card p-6 border-l-4 border-l-blue-500 animate-fade-in">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center font-bold">
                  ${posts[i][1].charAt(0)}
                </div>
                <div>
                  <div class="font-bold text-slate-900">@${posts[i][1]}</div>
                  <div class="text-[10px] font-bold text-slate-300 uppercase">${time}</div>
                </div>
              </div>
            </div>
            <p class="text-slate-600 text-sm leading-relaxed">${posts[i][2]}</p>
          </div>`;
      }
      document.getElementById('feed-content').innerHTML = html;
    }

    function renderTrades(trades) {
      let html = "";
      if (!trades || trades.length <= 1) {
        document.getElementById('trade-list').innerHTML = "<div class='p-10 text-center text-slate-400'>Empty log</div>";
        return;
      }
      for(let i = trades.length - 1; i >= 1; i--) {
        const isBuy = trades[i][2] === 'BUY';
        const colorClass = isBuy ? 'text-green-600' : 'text-red-600';
        const bgClass = isBuy ? 'bg-green-50' : 'bg-red-50';
        
        html += `
          <div class="premium-card p-5 flex justify-between items-center group hover:border-blue-200 transition-all">
            <div class="flex items-center gap-4">
                <div class="${bgClass} ${colorClass} px-3 py-1.5 rounded-xl text-[10px] font-black tracking-widest">
                    ${trades[i][2]}
                </div>
                <div>
                    <div class="font-extrabold text-slate-900">${trades[i][1]}</div>
                    <div class="text-[10px] font-bold text-slate-400">ENTRY: ${trades[i][3]}</div>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xs font-bold text-green-500">TP: ${trades[i][4]}</div>
                <div class="text-xs font-bold text-red-400">SL: ${trades[i][5]}</div>
            </div>
          </div>`;
      }
      document.getElementById('trade-list').innerHTML = html;
    }

    // Handle initial tab state based on width
    window.addEventListener('resize', () => {
        if(window.innerWidth >= 1024) {
            document.getElementById('trade-section').classList.remove('hidden');
            document.getElementById('feed-section').classList.remove('hidden');
        }
    });
  </script>
</body>
</html>